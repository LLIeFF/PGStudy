##в первой сессии новую таблицу и наполнить ее данными create table persons(id serial, first_name text, second_name text); insert into persons(first_name, second_name) values('ivan', 'ivanov'); insert into persons(first_name, second_name) values('petr', 'petrov'); commit;

##посмотреть текущий уровень изоляции: show transaction isolation level - read committed
##начать новую транзакцию в обоих сессиях с дефолтным (не меняя) уровнем изоляции
##в первой сессии добавить новую запись insert into persons(first_name, second_name) values('sergey', 'sergeev');
##сделать select from persons во второй сессии
##видите ли вы новую запись и если да то почему? - Новой записи не видно, потому что выбранный уровень изоляции транзации (дефолтный - read committed) не позволяет читать данные, незакоммиченные другими транзакциями
##завершить первую транзакцию - commit;
##сделать select from persons во второй сессии
##видите ли вы новую запись и если да то почему? - Новая запись появилась, потому что мы закоммитили первую транзакцию. Теперь текущий уровень изоляции позволяет её читать
##завершите транзакцию во второй сессии
##начать новые но уже repeatable read транзации - set transaction isolation level repeatable read;
##в первой сессии добавить новую запись insert into persons(first_name, second_name) values('sveta', 'svetova');
##сделать select* from persons во второй сессии*
##видите ли вы новую запись и если да то почему? - Новой записи не видно, потому что выбранный уровень изоляции транзации (repeatable read) также не позволяет читать данные, незакоммиченные другими транзакциями
##завершить первую транзакцию - commit;
##сделать select from persons во второй сессии
##видите ли вы новую запись и если да то почему? - Новой записи не видно, хотя здесь изначально ожидалось фантомное чтение (вставка записи другой транзацией). Но, согласно документации Postgres, реализация уровня изоляции Repeatable Read в PostgreSQL строже, чем стандарт SQL (например, MS SQL Server показывает здесь фантом), и фантомного чтения на этом уровне не допускается
##завершить вторую транзакцию
##сделать select * from persons во второй сессии
##видите ли вы новую запись и если да то почему? - Новая запись появилась, т.к. обе транзакции закоммичены