# Docker Desktop развёрнут в системе Windows 10 через дистрибутив, взяты с официального сайта
# Все команды - в окне Windows Powershell
# Разворачиваем ubuntu 22.04 LTS (:jammy) в Docker, далее в ней Postgres 15

## Загружаем образ:
## docker pull ubuntu:jammy
## Создаём контейнер:
## docker create -it --name jelly ubuntu:jammy
## Запускаем контейнер:
## docker start jelly
## Заходим в систему:
## docker attach jelly
## Мы в ubuntu. Проверяем версию:
## cat /etc/os-release
## PRETTY_NAME="Ubuntu 22.04.5 LTS"
## NAME="Ubuntu"
## VERSION_ID="22.04"
##
## Обновляем существущие пакеты:
## apt update
## apt upgrade
## (мы под рутом, sudo не требуется)
## Установим полезные пакеты ПО для работы:
## apt install dirmngr ca-certificates software-properties-common apt-transport-https lsb-release curl -y
## Импортируем GPG-ключ репозитрия:
## curl -fSsL https://www.postgresql.org/media/keys/ACCC4CF8.asc | gpg --dearmor | tee /usr/share/keyrings/postgresql.gpg > /dev/null
## Подключим репозитрий:
## echo deb [arch=amd64,arm64,ppc64el signed-by=/usr/share/keyrings/postgresql.gpg] http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main | tee /etc/apt/sources.list.d/postgresql.list
## Обновим пакеты ещё раз:
## apt update
## Установим Postgres сервер и клиент:
## apt install postgresql-client-15 postgresql-15
## Запустим серверную службу:
## service postgresql start
### (наша ОС работает через WSL, никакие systemctl здесь не работают)
## Зайдём в ОС под пользователем postgres:
## su - postgres
## Проверим, что кластер запущен:
## pg_lsclusters
### postgres@362f3e40ce71:~$ pg_lsclusters
### Ver Cluster Port Status Owner    Data directory              Log file
### 15  main    5432 online postgres /var/lib/postgresql/15/main /var/log/postgresql/postgresql-15-main.log
## Запустим клиента:
## psql -U postgres template1
### (мы в консоли, подключились к системной БД template1, можем посылать запросы на сервер)
## Зададим пароль для пользователя posgres:
## ALTER USER postgres WITH PASSWORD 'postgres';
## Выйдем из клиента:
## \q
## Разлогинимся в ОС от postgres:
## exit
### (мы снова под рутом)
## Подключимся клиентом:
## psql -U postgres -h localhost
### (запрашивается пароль, вводим его)
## Создаём таблицу:
## create table test(c1 text);
## Добавляем запись:
## insert into test values('1');
## Выходим:
## \q
## Снова логинимлся под postgres:
## su - postgres
## Останавливаем кластер:
## pg_ctlcluster 15 main stop